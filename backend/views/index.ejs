<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªá Th·ªëng B√£i ƒê·ªó Xe Th√¥ng Minh</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        display: flex;
      }
      .sidebar {
        background: #f8f9fa;
        padding: 15px;
        text-align: left;
        border-right: 2px solid #ccc;
        width: 250px;
        background: linear-gradient(to right, #007bff, #00c3ff);
      }
      .container {
        flex: 1;
        padding: 5px;
      }
      .lane-container {
        display: flex;
        gap: 20px;
        margin-top: 80px;
      }
      .lane {
        flex: 1;
        padding: 20px;
        background: #f0f0f0;
        border-radius: 10px;
      }
      .lane-title {
        margin-top: 10px;
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .plate-container {
        display: flex;
        justify-content: space-between;
      }
      .plate {
        flex: 1;
        text-align: center;
      }
      .plate img {
        width: 100px;
        height: 60px;
        object-fit: cover;
        margin-bottom: 100px;
      }
      .thong-ke-container {
        padding-top: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

.thong-ke-wrapper {
    display: flex;
    justify-content: center; 
    gap: 40px; /* Kho·∫£ng c√°ch gi·ªØa 2 b·∫£ng */
    width: 100%;
}

.stats, .stats_exit {
    width: 320px; /* ƒê·ªãnh k√≠ch th∆∞·ªõc cho b·∫£ng */
    padding: 20px;
    border: 2px solid #ddd;
    border-radius: 10px;
    background-color: #f9f9f9;
    text-align: center;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
}

/* .buttons-wrapper {
    display: flex;
    justify-content: center;
    gap: 20px;
    width: 100%;
}
.buttons {
  display: flex;
    justify-content: center; 
    gap: 20px; 
    width: 100%;
}

      .buttons button {
        margin: 5px;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        color: white;
      }
      .buttons button:hover {
        opacity: 0.8;
        transform: scale(1.05);
      } */

      .bike {
        background: blue;
      }
      .motorbike {
        background: orange;
      }
      .car {
        background: red;
      }
      .employee {
        position: fixed;
        top: 20px;
        right: 20px;
        text-align: center;
      }
      .employee img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
      }
      /* N√∫t reset b√£i ƒë·ªó */
      .reset-btn {
        position: fixed;
        top: 20px;
        right: 120px;
        background: red;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h3>Th√¥ng Tin Xe</h3>
      <div id="thongTinXe">
        <p>Bi·ªÉn s·ªë: <span id="bienSo">---</span></p>
        <p>Th·ªùi gian v√†o: <span id="thoiGianVao">---</span></p>
        <p>Th·ªùi gian ra: <span id="thoiGianRa">---</span></p>
        <p>S·ªë ti·ªÅn: <span id="soTien">---</span></p>
    </div>
    </div>
    <div class="container">
      <h1>H·ªá Th·ªëng B√£i ƒê·ªó Xe Th√¥ng Minh</h1>
      <p
        id="current-time"
        style="font-size: 18px; font-weight: bold; color: #333"
      ></p>
      <script>
        
      </script>
      <div></div>

      <video id="webcam" autoplay width="1000px" height="400px"></video>
      <button id="capture">Ch·ª•p ·∫£nh</button>
      <canvas id="snapshot" style="display: none"></canvas>
      <button id="switch-lane" onclick="switchLane()">Chuy·ªÉn l√†n</button>

      <div class="lane-container">
        <div class="lane">
          <p class="lane-title">L√†n xe v√†o</p>
          <div class="plate-container">
            <div class="plate">
              <h3>Bi·ªÉn s·ªë tr∆∞·ªõc</h3>
              <img
                id="bienso_truoc_vao"
                src="default.png"
                alt="·∫¢nh bi·ªÉn s·ªë tr∆∞·ªõc"
              />
            </div>
            <div class="plate">
              <h3>Bi·ªÉn s·ªë sau</h3>
              <img
                id="bienso_sau_vao"
                src="default.png"
                alt="·∫¢nh bi·ªÉn s·ªë sau"
              />
            </div>
          </div>
        </div>
        <div class="lane">
          <p class="lane-title">L√†n xe ra</p>
          <div class="plate-container">
            <div class="plate">
              <h3>Bi·ªÉn s·ªë tr∆∞·ªõc</h3>
              <img  
                id="bienso_truoc_ra"
                src="default.png"
                alt="·∫¢nh bi·ªÉn s·ªë tr∆∞·ªõc l√†n ra"
              />
            </div>
            <div class="plate">
              <h3>Bi·ªÉn s·ªë sau</h3>
              <img
                id="bienso_sau_ra"
                src="default.png"
                alt="·∫¢nh bi·ªÉn s·ªë sau l√†n ra"
              />
            </div>
          </div>
        </div>
      </div>

      <div class="thong-ke-container">
        <div class="thong-ke-wrapper">
            <div class="stats">
                <h2>Th·ªëng k√™ xe v√†o</h2>
                <p>üöó √î t√¥: <span id="car-count">300</span> ch·ªó tr·ªëng</p>
                <p>üèçÔ∏è Xe m√°y: <span id="motorbike-count">250</span> ch·ªó tr·ªëng</p>
                <p>üö≤ Xe ƒë·∫°p: <span id="bike-count">100</span> ch·ªó tr·ªëng</p>
            </div>
            <div class="stats_exit">
                <h2>Th·ªëng k√™ xe ra</h2>
                <p>üöó √î t√¥: <span id="car-count-exit">0</span> xe ƒëang ƒë·ªó</p>
                <p>üèçÔ∏è Xe m√°y: <span id="motorbike-count-exit">0</span> xe ƒëang ƒë·ªó</p>
                <p>üö≤ Xe ƒë·∫°p: <span id="bike-count-exit">0</span> xe ƒëang ƒë·ªó</p>
            </div>
        </div>
    
        <!-- <div class="buttons-wrapper">
          <div class="buttons">
            <button class="bike" onclick="vehicleEnter('bike')">Xe ƒë·∫°p/ƒëi·ªán</button>
            <button class="motorbike" onclick="vehicleEnter('motorbike')">Xe m√°y</button>
            <button class="car" onclick="vehicleEnter('car')">√î t√¥</button>
          </div>
          <div class="buttons">
            <button class="bike" onclick="vehicleExit('bike')">Xe ƒë·∫°p/ƒëi·ªán ra</button>
            <button class="motorbike" onclick="vehicleExit('motorbike')">Xe m√°y ra</button>
            <button class="car" onclick="vehicleExit('car')">√î t√¥ ra</button>
          </div>
      </div> -->
      
    </div>
    

  
    <div class="employee">
      <img src="./1.jpg" alt="Nh√¢n vi√™n" />
      <p><strong id="employee-name">Nh√¢n vi√™n</strong></p>
    </div>






    <script>
      function updateTime() {
        const now = new Date();
        const formattedTime = now.toLocaleString("vi-VN", {
          timeZone: "Asia/Ho_Chi_Minh",
        });
        document.getElementById(
          "current-time"
        ).innerText = `‚è∞ Th·ªùi gian hi·ªán t·∫°i: ${formattedTime}`;
      }

      // C·∫≠p nh·∫≠t th·ªùi gian ngay khi t·∫£i trang
      updateTime();

      // C·∫≠p nh·∫≠t m·ªói gi√¢y
      setInterval(updateTime, 1000);


      document.addEventListener("DOMContentLoaded", function () {
    let currentLane = 'vao'; 
    let step = 0; 
    let capturedImages = { truoc: null, sau: null }; 

    const video = document.getElementById("webcam");
    const canvas = document.getElementById("snapshot");
    const context = canvas.getContext("2d");
    const captureButton = document.getElementById("capture");
    const switchLaneButton = document.getElementById("switch-lane");

    const bienSoEl = document.getElementById("bienSo");
    const thoiGianVaoEl = document.getElementById("thoiGianVao");
    const thoiGianRaEl = document.getElementById("thoiGianRa");
    const soTienEl = document.getElementById("soTien");

    const imgBienso = {
        vao: { truoc: document.getElementById("bienso_truoc_vao"), sau: document.getElementById("bienso_sau_vao") },
        ra: { truoc: document.getElementById("bienso_truoc_ra"), sau: document.getElementById("bienso_sau_ra") }
    };

    let vehicleCounts = {
        car: { available: 300, parked: 0 },
        motorbike: { available: 250, parked: 0 },
        bike: { available: 100, parked: 0 }
    };

    function updateVehicleCount() {
        document.getElementById("car-count").textContent = vehicleCounts.car.available;
        document.getElementById("motorbike-count").textContent = vehicleCounts.motorbike.available;
        document.getElementById("bike-count").textContent = vehicleCounts.bike.available;

        document.getElementById("car-count-exit").textContent = vehicleCounts.car.parked;
        document.getElementById("motorbike-count-exit").textContent = vehicleCounts.motorbike.parked;
        document.getElementById("bike-count-exit").textContent = vehicleCounts.bike.parked;
    }

    function vehicleEnter(type) {
        if (vehicleCounts[type].available > 0) {
            vehicleCounts[type].available--;
            vehicleCounts[type].parked++;
            updateVehicleCount();
            alert(`üöó Xe ${type} ƒë√£ v√†o.`);
        } else {
            alert(`‚ùå B√£i ƒë√£ ƒë·∫ßy, kh√¥ng c√≤n ch·ªó cho xe ${type}.`);
        }
    }

    function vehicleExit(type) {
        if (vehicleCounts[type].parked > 0) {
            vehicleCounts[type].available++;
            vehicleCounts[type].parked--;
            updateVehicleCount();
            alert(`üöó Xe ${type} ƒë√£ r·ªùi kh·ªèi.`);
        } else {
            alert(`‚ùå Kh√¥ng c√≥ xe ${type} trong b√£i.`);
        }
    }

    function switchLane() {
        currentLane = currentLane === 'vao' ? 'ra' : 'vao';
        capturedImages = { truoc: null, sau: null }; 
        alert(`üîÑ ƒê√£ chuy·ªÉn sang l√†n xe ${currentLane === 'vao' ? 'v√†o' : 'ra'}!`);
    }

    async function startWebcam() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
        } catch (error) {
            console.error("L·ªói webcam:", error);
        }
    }

    function saveImage(imageData, fileName) {
        const link = document.createElement("a");
        link.href = imageData;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function getCurrentTime() {
        return new Date().toLocaleString("vi-VN", { timeZone: "Asia/Ho_Chi_Minh" });
    }

    captureButton.addEventListener("click", () => {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = canvas.toDataURL("image/jpeg", 1.0);

        const imgType = step === 0 ? "truoc" : "sau";
        imgBienso[currentLane][imgType].src = imageData;
        // saveImage(imageData, `bienso_${imgType}_${currentLane}.jpg`);
        capturedImages[imgType] = imageData;

        if (step === 0) {
            step = 1; 
        } else {
            if (capturedImages.truoc && capturedImages.sau) {
                bienSoEl.textContent = "29A-123.45";
                if (currentLane === "vao") {
                    thoiGianVaoEl.textContent = getCurrentTime();
                    thoiGianRaEl.textContent = "---";
                    soTienEl.textContent = "---";
                    vehicleEnter("car"); 
                } else {
                    thoiGianRaEl.textContent = getCurrentTime();
                    soTienEl.textContent = "50.000 VND"; 
                    vehicleExit("car"); 
                }
                capturedImages = { truoc: null, sau: null }; 
            }
            step = 0; 
        }
    });

    switchLaneButton.addEventListener("click", switchLane);

    startWebcam();
    updateVehicleCount();
});




    </script>
  </body>
</html>
